// src/components/Header.jsx
import React from 'react';
import { AppBar, Toolbar, Box, Typography, Select, MenuItem } from '@mui/material';
import { useNavigate, useLocation } from 'react-router-dom';
import WuLogo from '../assets/wu-logo.png';
import LacaFlag from '../assets/laca-flag.png';
import { partitionList } from '../services/occupancy.service';

export default function Header() {
  const navigate = useNavigate();
  const loc = useLocation();


  // If path is /partition/:p(/suffix...), grab p and any suffix after it
  const pathParts = loc.pathname.split('/');
  let currentPartition = '';
  let suffix = '';
  if (pathParts[1] === 'partition' && pathParts[2]) {
    currentPartition = decodeURIComponent(pathParts[2]);
    // join any trailing segments as a suffix (e.g. "details" or "history/custom")
    suffix = pathParts.slice(3).join('/');
  }


  return (
    <AppBar position="static" color="primary" sx={{ mb: 2 }}>

      <Toolbar sx={{ justifyContent: 'space-between' }}>
        <Box display="flex" alignItems="center">
          <Box component="img" src={WuLogo} alt="WU Logo" sx={{ height: 36, mr: 2 }} />
          <Typography variant="h6" sx={{ fontWeight: 600 }}>
             Western Union – LACA
            {currentPartition && <> • {currentPartition.replace('CR.Costa Rica Partition','Costa Rica')}</>}
          </Typography>
        </Box>
        <Box display="flex" alignItems="center">
          <Select
            size="small"
            value={currentPartition}
            displayEmpty
  

          onChange={e => {
            const p = e.target.value;
            if (!p) {
              // back to root
              return navigate('/');
            }
            // build new path, preserving any suffix
            const newBase = `/partition/${encodeURIComponent(p)}`;
            const newPath = suffix
              ? `${newBase}/${suffix}`
              : newBase;
            navigate(newPath);
          }}



            sx={{ bgcolor: 'background.paper', mr: 2 }}
          >
            <MenuItem value="">— Select Partition —</MenuItem>
            {partitionList.map(p => (
              <MenuItem key={p} value={p}>{p.replace('Partition','')}</MenuItem>
            ))}
          </Select>
          <Box component="img" src={LacaFlag} alt="LACA Flag" sx={{ height: 30 }} />
        </Box>
      </Toolbar>
    </AppBar>
  );
}
