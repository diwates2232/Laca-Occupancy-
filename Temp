// src/config/db.js
require('dotenv').config();    // just in case it wasn‚Äôt routed through server.js
const sql = require('mssql');

// ‚Äî‚Äî DEBUGGING CHECK ‚Äî‚Äî
if (!process.env.DB_SERVER) {
  console.error('‚ùå ENV ERROR: DB_SERVER is undefined. Did you place .env in the project root?');
  process.exit(1);
}
console.log('üîç Connecting to DB_SERVER:', process.env.DB_SERVER);

// ‚Äî‚Äî ACTUAL CONFIG ‚Äî‚Äî
const dbConfig = {
  user:     process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  server:   process.env.DB_SERVER,
  database: process.env.DB_DATABASE,
  port:     parseInt(process.env.DB_PORT, 10),
  options: {
    encrypt: true,
    trustServerCertificate: true
  },
  pool: {
    max: 10,
    min: 0,
    idleTimeoutMillis: 30000
  }
};

const poolPromise = new sql.ConnectionPool(dbConfig)
  .connect()
  .then(pool => {
    console.log('‚úÖ MSSQL connected');
    return pool;
  })
  .catch(err => {
    console.error('‚ùå MSSQL connection failed', err);
    process.exit(1);
  });

module.exports = {
  sql,
  poolPromise
};













PS C:\Users\W0024618\Desktop\emea-occupancy-backend> node server.js
üöÄ Server running on port 3005
‚ùå MSSQL connection failed TypeError: The "config.server" property is required and must be of type string.
    at new Connection (C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\tedious\lib\connection.js:276:13)
    at C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\mssql\lib\tedious\connection-pool.js:78:19
    at new Promise (<anonymous>)
    at ConnectionPool._poolCreate (C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\mssql\lib\tedious\connection-pool.js:67:12)
    at ConnectionPool._connect (C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\mssql\lib\base\connection-pool.js:446:10)
    at C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\mssql\lib\base\connection-pool.js:418:19
    at new Promise (<anonymous>)
    at ConnectionPool.connect (C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\mssql\lib\base\connection-pool.js:417:12)
    at Object.<anonymous> (C:\Users\W0024618\Desktop\emea-occupancy-backend\src\config\db.js:24:4)
    at Module._compile (node:internal/modules/cjs/loader:1730:14)
