// src/config/db.js
require('dotenv').config();
const sql = require('mssql');

// Pull in raw env-vars
const rawUser     = process.env.DB_USER;
const rawPassword = process.env.DB_PASSWORD;
const rawServer   = process.env.DB_SERVER;
const rawDatabase = process.env.DB_DATABASE;
const rawPort     = process.env.DB_PORT;

// Show lengths‚Äîif you‚Äôve got extra spaces/BOM, you‚Äôll see them here
console.log(`DB_USER     = "${rawUser}"     (length ${rawUser?.length})`);
console.log(`DB_PASSWORD = "${rawPassword}" (length ${rawPassword?.length})`);
console.log(`DB_SERVER   = "${rawServer}"   (length ${rawServer?.length})`);
console.log(`DB_DATABASE = "${rawDatabase}" (length ${rawDatabase?.length})`);
console.log(`DB_PORT     = "${rawPort}"     (length ${rawPort?.length})`);

// Trim everything
const DB_USER     = rawUser?.trim();
const DB_PASSWORD = rawPassword?.trim();
const DB_SERVER   = rawServer?.trim();
const DB_DATABASE = rawDatabase?.trim();
const DB_PORT     = parseInt(rawPort?.trim(), 10);

const dbConfig = {
  server: DB_SERVER,
  port:   DB_PORT,
  database: DB_DATABASE,
  authentication: {
    type: 'default',
    options: {
      userName: DB_USER,
      password: DB_PASSWORD
    }
  },
  options: {
    encrypt: true,
    trustServerCertificate: true
  },
  pool: {
    max: 10,
    min: 0,
    idleTimeoutMillis: 30000
  }
};

console.log(
  `üîç Connecting to ${DB_SERVER}:${DB_PORT} ` +
  `DB="${DB_DATABASE}" as ${DB_USER}`
);

sql
  .connect(dbConfig)
  .then(pool => {
    console.log('‚úÖ MSSQL connected');
    module.exports = { sql, poolPromise: Promise.resolve(pool) };
  })
  .catch(err => {
    console.error('‚ùå MSSQL connection failed', err);
    process.exit(1);
  });







# .env (must be at C:\Users\W0024618\Desktop\emea-occupancy-backend\.env)
DB_USER=GSOC_Test
DB_PASSWORD=Westernuniongsoc@2025
DB_SERVER=SRVWUFRA0986V
DB_DATABASE=ACVSUJournal_00010027
DB_PORT=1433
PORT=3005





// src/config/db.js
require('dotenv').config();
const sql = require('mssql');

// Quick sanity check at startup
if (!process.env.DB_SERVER || !process.env.DB_USER) {
  console.error('‚ùå Missing DB_SERVER or DB_USER in environment');
  process.exit(1);
}

const dbConfig = {
  server: process.env.DB_SERVER,        // e.g. "SRVWUFRA0986V"
  port:   parseInt(process.env.DB_PORT, 10), // e.g. 1433
  database: process.env.DB_DATABASE,    // e.g. "ACVSUJournal_00010027"
  options: {
    encrypt: true,
    trustServerCertificate: true
  },
  authentication: {
    type: 'default',                    // SQL Server Authentication
    options: {
      userName: process.env.DB_USER,    // e.g. "GSOC_Test"
      password: process.env.DB_PASSWORD // e.g. "Westernuniongsoc@2025"
    }
  },
  pool: {
    max: 10,
    min: 0,
    idleTimeoutMillis: 30000
  }
};

// Debug print
console.log(
  `üîç Connecting to ${dbConfig.server}:${dbConfig.port} ` +
  `DB="${dbConfig.database}" as ${dbConfig.authentication.options.userName}`
);

const poolPromise = new sql.ConnectionPool(dbConfig)
  .connect()
  .then(pool => {
    console.log('‚úÖ MSSQL connected');
    return pool;
  })
  .catch(err => {
    console.error('‚ùå MSSQL connection failed', err);
    process.exit(1);
  });

module.exports = {
  sql,
  poolPromise
};







We got this error , i have run same query using same db user and using password query is execute in mssql since we got this error ,
so which file you need to check and update

C:\Users\W0024618\Desktop\emea-occupancy-backend> node test-connection.js
üß™ Testing connection with config: {
  user: 'GSOC_Test',
  server: 'SRVWUFRA0986V',
  database: 'ACVSUJournal_00010027',
  port: 1433
}
‚ùå test-connection failed: ConnectionError: Login failed for user 'GSOC_Test'.
    at C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\mssql\lib\tedious\connection-pool.js:85:17
    at Connection.onConnect (C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\tedious\lib\connection.js:849:9)
    at Object.onceWrapper (node:events:633:26)
    at Connection.emit (node:events:518:28)
    at Connection.emit (C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\tedious\lib\connection.js:970:18)
    at C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\tedious\lib\connection.js:2369:18
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  code: 'ELOGIN',
  originalError: ConnectionError: Login failed for user 'GSOC_Test'.
      at Login7TokenHandler.onErrorMessage (C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\tedious\lib\token\handler.js:186:19)
      at Readable.<anonymous> (C:\Users\W0024618\Desktop\emea-occupancy-backend\node_modules\tedious\lib\token\token-stream-parser.js:19:33)
      at Readable.emit (node:events:518:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushObjectMode (node:internal/streams/readable:538:3)
      at Readable.push (node:internal/streams/readable:393:5)
      at nextAsync (node:internal/streams/from:194:22)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
    code: 'ELOGIN'
  }
}
PS C:\Users\W0024618\Desktop\emea-occupancy-backend>
